"use strict";angular.module("vidadaApp",["LocalStorageModule","tmh.dynamicLocale","ngResource","ui.router","ngCookies","pascalprecht.translate","ngCacheBuster","infinite-scroll","ui.bootstrap","ngSanitize","ngMaterial","ngAnimate","ngAria","ngMessages"]).run(["$rootScope","$location","$window","$http","$state","$translate","Auth","Principal","Language","ENV","VERSION","tmhDynamicLocale",function(e,t,a,r,n,o,i,l,s,u,c,d){e.ENV=u,e.VERSION=c,e.$on("$stateChangeStart",function(t,a,r){e.toState=a,e.toStateParams=r,l.isIdentityResolved()&&i.authorize(),s.getCurrent().then(function(e){o.use(e)})}),e.$on("$stateChangeSuccess",function(t,r,n,i,l){var s="global.title";e.previousStateName=i.name,e.previousStateParams=l,r.data.pageTitle&&(s=r.data.pageTitle),o(s).then(function(e){a.document.title=e})}),e.back=function(){"activate"===e.previousStateName||null===n.get(e.previousStateName)?n.go("home"):n.go(e.previousStateName,e.previousStateParams)},d.set("de")}]).factory("authInterceptor",["$rootScope","$q","$location","localStorageService",function(e,t,a,r){return{request:function(e){e.headers=e.headers||{};var t=r.get("token");return t&&(e.headers.Authorization="Bearer "+t.access_token),e}}}]).factory("authExpiredInterceptor",["$rootScope","$q","$injector","localStorageService",function(e,t,a,r){return{responseError:function(e){if(console.log("Checking if token has expired: "+e.status+" msg: "+e.data.error),401===e.status&&("invalid_token"==e.data.error||"Unauthorized"==e.data.error)){r.remove("token");var n=a.get("Principal");if(n.isAuthenticated()){var o=a.get("Auth");o.authorize(!0)}}return t.reject(e)}}}]).config(["$stateProvider","$compileProvider","$mdThemingProvider","$urlRouterProvider","$httpProvider","$locationProvider","$translateProvider","tmhDynamicLocaleProvider","httpRequestInterceptorCacheBusterProvider",function(e,t,a,r,n,o,i,l,s){a.theme("default").primaryPalette("deep-purple").accentPalette("pink").warnPalette("red").backgroundPalette("grey"),t.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|mpv|vlc|chrome-extension):/),s.setMatchlist([/.*api.*/,/.*protected.*/],!0),r.otherwise("/"),e.state("site",{"abstract":!0,resolve:{authorize:["Auth",function(e){return e.authorize()}],translatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("global"),t.addPart("language"),e.refresh()}]}}),n.interceptors.push("authInterceptor"),n.interceptors.push("authExpiredInterceptor"),i.useLoader("$translatePartialLoader",{urlTemplate:"i18n/{lang}/{part}.json"}),i.preferredLanguage("en"),i.useCookieStorage(),l.localeLocationPattern("bower_components/angular-i18n/angular-locale_{{locale}}.js"),l.useCookieStorage("NG_TRANSLATE_LANG_KEY")}]),angular.module("vidadaApp").constant("ENV","dev").constant("VERSION","0.0.1-SNAPSHOT"),angular.module("vidadaApp").factory("Auth",["$rootScope","$state","$q","$translate","Principal","AuthServerProvider","Account","Register","Activate","Password",function(e,t,a,r,n,o,i,l,s,u){return{login:function(e,t){var i=t||angular.noop,l=a.defer();return o.login(e).then(function(e){return console.log("Successfully logged in, now getting current users principal..."),n.identity(!0).then(function(t){console.log("Got the principal: "+JSON.stringify(t)),t.langKey&&r.use(t.langKey),l.resolve(e)}),i()})["catch"](function(e){return console.log("Auth failed, rejecting..."),this.logout(),l.reject(e),i(e)}.bind(this)),l.promise},logout:function(){console.log("Logging out..."),o.logout(),n.authenticate(null)},authorize:function(a){return n.identity(a).then(function(){var a=n.isAuthenticated();e.toState.data.roles&&e.toState.data.roles.length>0&&!n.isInAnyRole(e.toState.data.roles)&&(a?(console.log("User is signed in but not authorized for desired state!"),t.go("accessdenied")):(console.log("User is not authenticated!"),e.returnToState=e.toState,e.returnToStateParams=e.toStateParams,t.go("login")))})},createAccount:function(e,t){var a=t||angular.noop;return l.save(e,function(){return a(e)},function(e){return this.logout(),a(e)}.bind(this)).$promise},updateAccount:function(e,t){var a=t||angular.noop;return i.save(e,function(){return a(e)},function(e){return a(e)}.bind(this)).$promise},activateAccount:function(e,t){var a=t||angular.noop;return s.get(e,function(e){return a(e)},function(e){return a(e)}.bind(this)).$promise},changePassword:function(e,t){var a=t||angular.noop;return u.save(e,function(){return a()},function(e){return a(e)}).$promise}}}]),angular.module("vidadaApp").directive("hasAnyRole",["Principal",function(e){return{restrict:"A",link:function(t,a,r){var n=function(){a.removeClass("hidden")},o=function(){a.addClass("hidden")},i=function(t){var a;t&&n(),a=e.isInAnyRole(l),a?n():o()},l=r.hasAnyRole.replace(/\s+/g,"").split(",");l.length>0&&i(!0)}}}]).directive("poop",function(){return{restrict:"A",link:function(e,t,a){console.log("Hello directive myCustomer")}}}).directive("hasRole",["Principal",function(e){return{restrict:"A",link:function(t,a,r){var n=function(){a.removeClass("hidden")},o=function(){a.addClass("hidden")},i=function(t){var a;t&&n(),a=e.isInRole(l),a?n():o()},l=r.hasRole.replace(/\s+/g,"");console.log("Executing hasRole Directive: -->'"+l+"' :: "+JSON.stringify(r)),l.length>0&&i(!0)}}}]),angular.module("vidadaApp").factory("Principal",["$q","Account",function(e,t){var a,r=!1;return{isIdentityResolved:function(){return angular.isDefined(a)},isAuthenticated:function(){return r},isInRole:function(e){return r&&a&&a.roles?-1!==a.roles.indexOf(e):!1},isInAnyRole:function(e){if(!r||!a.roles)return!1;for(var t=0;t<e.length;t++)if(this.isInRole(e[t]))return!0;return!1},authenticate:function(e){a=e,r=null!==e},identity:function(n){var o=e.defer();return n===!0&&(a=void 0),angular.isDefined(a)?(o.resolve(a),o.promise):(console.log("retrieving the identity / principal data from the server..."),t.get().$promise.then(function(e){console.log("Successfully got the account: "+JSON.stringify(e)),a=e,r=!0,o.resolve(a)})["catch"](function(){console.log("Failed to fetch account from server!"),a=null,r=!1,o.resolve(a)}),o.promise)}}}]),angular.module("vidadaApp").factory("AuthServerProvider",["$http","localStorageService","Base64",function(e,t,a){return{login:function(a){return e.post("/api/oauth/login",a).then(function(e){var a=e.data.token;return console.log("Login success, got token: "+a),t.set("token",{access_token:a,expires_at:null}),a})},logout:function(){console.log("Logging out, clearing local JWT!"),e.post("/api/oauth/logout").then(function(){t.clearAll()},function(){t.clearAll()})},getToken:function(){return t.get("token")},hasValidToken:function(){var e=this.getToken();return e&&!0}}}]),angular.module("vidadaApp").factory("Account",["$resource",function(e){return e("/api/oauth/users/current",{},{get:{method:"GET",params:{},isArray:!1}})}]),angular.module("vidadaApp").factory("Activate",["$resource",function(e){return e("api/oauth/activate",{},{get:{method:"GET",params:{},isArray:!1}})}]),angular.module("vidadaApp").factory("Password",["$resource",function(e){return e("api/account/change_password",{},{})}]),angular.module("vidadaApp").factory("Register",["$resource",function(e){return e("api/register",{},{})}]),angular.module("vidadaApp").directive("showValidation",function(){return{restrict:"A",require:"form",link:function(e,t){t.find(".form-group").each(function(){var t=$(this),a=t.find("input[ng-model],textarea[ng-model],select[ng-model]");a.length>0&&a.each(function(){var a=$(this);e.$watch(function(){return a.hasClass("ng-invalid")&&a.hasClass("ng-dirty")},function(e){t.toggleClass("has-error",e)})})})}}}),angular.module("vidadaApp").directive("vidadaAppPager",function(){return{templateUrl:"scripts/components/form/pager.html"}}),angular.module("vidadaApp").directive("vidadaAppPagination",function(){return{templateUrl:"scripts/components/form/pagination.html"}}),angular.module("vidadaApp").controller("LanguageController",["$scope","$translate","Language",function(e,t,a){e.changeLanguage=function(e){t.use(e)},a.getAll().then(function(t){e.languages=t})}]),angular.module("vidadaApp").factory("Language",["$q","$http","$translate","LANGUAGES",function(e,t,a,r){return{getCurrent:function(){var t=e.defer(),r=a.storage().get("NG_TRANSLATE_LANG_KEY");return angular.isUndefined(r)&&(r="en"),t.resolve(r),t.promise},getAll:function(){var t=e.defer();return t.resolve(r),t.promise}}}]).constant("LANGUAGES",["en","fr"]),angular.module("vidadaApp").directive("activeMenu",["$translate","$locale","tmhDynamicLocale",function(e,t,a){return{restrict:"A",link:function(t,r,n){var o=n.activeMenu;t.$watch(function(){return e.use()},function(e){o===e?(a.set(o),r.addClass("active")):r.removeClass("active")})}}}]).directive("activeLink",["location",function(e){return{restrict:"A",link:function(t,a,r){var n=r.activeLink,o=r.href;o=o.substring(1),t.location=e,t.$watch("location.path()",function(e){o===e?a.addClass(n):a.removeClass(n)})}}}]),angular.module("vidadaApp").directive("updateTitle",["$rootScope","$timeout","$translate",function(e,t,a){return{restrict:"A",link:function(r,n,o){console.log("Setting up updateTitle directive, listening to $stateChangeSuccess"),e.$on("$stateChangeSuccess",function(e,r,o,i,l){var s="Vidada";if(r.data&&r.data.pageTitle){var u=r.data.pageTitle;a(u).then(function(e){s=e,t(function(){n.text(s)},0,!1)})}})}}}]),angular.module("vidadaApp").factory("User",["$resource",function(e){return e("api/users/:login",{},{query:{method:"GET",isArray:!0},get:{method:"GET",transformResponse:function(e){return e=angular.fromJson(e)}}})}]),angular.module("vidadaApp").service("Base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode=function(t){for(var a,r,n,o,i,l="",s="",u="",c=0;c<t.length;)a=t.charCodeAt(c++),r=t.charCodeAt(c++),s=t.charCodeAt(c++),n=a>>2,o=(3&a)<<4|r>>4,i=(15&r)<<2|s>>6,u=63&s,isNaN(r)?i=u=64:isNaN(s)&&(u=64),l=l+e.charAt(n)+e.charAt(o)+e.charAt(i)+e.charAt(u),a=r=s="",n=o=i=u="";return l},this.decode=function(t){var a,r,n,o,i,l="",s="",u="",c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)n=e.indexOf(t.charAt(c++)),o=e.indexOf(t.charAt(c++)),i=e.indexOf(t.charAt(c++)),u=e.indexOf(t.charAt(c++)),a=n<<2|o>>4,r=(15&o)<<4|i>>2,s=(3&i)<<6|u,l+=String.fromCharCode(a),64!==i&&(l+=String.fromCharCode(r)),64!==u&&(l+=String.fromCharCode(s)),a=r=s="",n=o=i=u=""}}).factory("StorageService",["$window",function(e){return{get:function(t){return JSON.parse(e.localStorage.getItem(t))},save:function(t,a){e.localStorage.setItem(t,JSON.stringify(a))},remove:function(t){e.localStorage.removeItem(t)},clearAll:function(){e.localStorage.clear()}}}]),angular.module("vidadaApp").service("ErrorHandler",["$mdToast",function(e){this.showToast=function(t,a){e.show(e.simple().content("Error: "+t+" - "+a.data.error+" - "+a.data.exception).position("top").hideDelay(2e3))}}]),angular.module("vidadaApp").filter("characters",function(){return function(e,t,a){if(isNaN(t))return e;if(0>=t)return"";if(e&&e.length>t){if(e=e.substring(0,t),a)for(;" "===e.charAt(e.length-1);)e=e.substr(0,e.length-1);else{var r=e.lastIndexOf(" ");-1!==r&&(e=e.substr(0,r))}return e+"..."}return e}}).filter("words",function(){return function(e,t){if(isNaN(t))return e;if(0>=t)return"";if(e){var a=e.split(/\s+/);a.length>t&&(e=a.slice(0,t).join(" ")+"...")}return e}}).filter("bytes",[function(){return function(e,t){if("number"!=typeof e&&(e=parseFloat(e)),0===e)return"0 B";if(isNaN(e)||!isFinite(e))return"-";var a=0>e;a&&(e=-e),"number"!=typeof t&&(t=parseFloat(t)),!isNaN(t)&&isFinite(t)||(t=1);var r=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.min(Math.floor(Math.log(e)/Math.log(1024)),r.length-1),o=(e/Math.pow(1024,Math.floor(n))).toFixed(t);return(a?"-":"")+o+" "+r[n]}}]).filter("fullDateTime",["$filter",function(e){var t=e("date");return function(e){return t(e,"dd.MM.yyyy HH:mm")}}]).filter("secondsToDuration",[function(){return function(e,t){if("number"!=typeof e&&(e=parseFloat(e)),0===e)return"No Duration";if(isNaN(e)||!isFinite(e))return"-";var a=Math.floor(e/3600),r=Math.floor((e-3600*a)/60),n=a+"h "+r+"min";return n}}]).filter("trusted",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),angular.module("vidadaApp").service("ParseLinks",function(){this.parse=function(e){if(0==e.length)throw new Error("input must not be of zero length");var t=e.split(","),a={};return angular.forEach(t,function(e){var t=e.split(";");if(2!=t.length)throw new Error("section could not be split on ';'");var r=t[0].replace(/<(.*)>/,"$1").trim(),n={};r.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,t,a,r){n[t]=r});var o=n.page;angular.isString(o)&&(o=parseInt(o));var i=t[1].replace(/rel="(.*)"/,"$1").trim();a[i]=o}),a}}),angular.module("vidadaApp").service("ParseText",function(){this.replaceWord=function(e,t,a){return e.slice(0,t.left)+a+e.slice(t.right,e.length)},this.findWordAt=function(e,t){e=String(e),t=Number(t)>>>0;var a=e.slice(0,t+1).search(/[\w|\.]+$/),r=e.slice(t).search(/[^\w|\.]/);return 0>r?r=e.length:r+=t,{left:a,right:r,text:e.slice(a,r)}}}),angular.module("vidadaApp").factory("MediaLibrary",["$resource",function(e){return e("api/libraries/:libraryId",{libraryId:"@id"},{update:{method:"PUT"}})}]),angular.module("vidadaApp").factory("Media",["$resource",function(e){return e("api/medias/:mediaId",{mediaId:"@id"},{update:{method:"PUT"},get:{method:"GET",transformResponse:function(e){return angular.fromJson(e)},isArray:!1},getThumb:{url:"api/medias/:mediaId/thumbnail",method:"GET",transformResponse:function(e){return angular.fromJson(e)},isArray:!1}})}]).factory("MediaPage",["$resource",function(e){return{load:function(t,a,r){return e("api/medias",{},{get:{method:"GET",transformResponse:function(e){return angular.fromJson(e)},isArray:!1}}).get({page:t,pageSize:a,query:r.query,tagExpression:r.tagExpression,orderBy:r.orderBy.id,reverse:r.reversed})}}}]).factory("MediaInfinite",["MediaPage","$mdToast",function(e,t){var a=function(e){this.items=[],this.busy=!1,this.after="",this.itemCount=0,this.lastLoadedPage=-1,this.itemsPerPage=0,this.mediaQuery=e};return a.prototype.nextPage=function(){if(!this.busy){this.busy=!0;var a=this.lastLoadedPage+1*this.itemsPerPage;if(this.itemCount>=a){var r=this.lastLoadedPage+1;console.log("Requesting page "+r+"..."),e.load(r,15,this.mediaQuery).$promise.then(function(e){this.itemCount=e.totalListSize,this.itemsPerPage=e.maxPageSize,this.lastLoadedPage=e.page;var t=e.pageItems;console.log("Got page "+e.page+" with "+t.length+" items!");for(var a=0;a<t.length;a++)this.addMedia(t[a]);this.busy=!1}.bind(this),function(e){this.busy=!1,console.log("Failed to load media page!"+JSON.stringify(e)),t.show(t.simple().content("Failed to load media page "+r+"!").hideDelay(2e3))}.bind(this))}else console.log("Already all pages loaded, skipping nextPage() request!"),this.busy=!1}},a.prototype.addMedia=function(e){this.items.push(e)},a}]),angular.module("vidadaApp").factory("MediaSynchronisation",["$http",function(e){return{sync:function(){return e.post("/api/synchronisation")}}}]),angular.module("vidadaApp").factory("Tag",["$resource",function(e){return e("api/tags/:id",{id:"@_id"},{update:{method:"PUT"},"delete":{method:"DELETE",params:{id:"id"}}})}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("account",{"abstract":!0,parent:"site"})}]),angular.module("vidadaApp").controller("ActivationController",["$scope","$stateParams","Auth",function(e,t,a){a.activateAccount({key:t.key}).then(function(){e.error=null,e.success="OK"})["catch"](function(){e.success=null,e.error="ERROR"})}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("activate",{parent:"account",url:"/activate?key",data:{roles:[],pageTitle:"activate.title"},views:{"content@":{templateUrl:"scripts/app/account/activate/activate.html",controller:"ActivationController"}},resolve:{translatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("activate"),e.refresh()}]}})}]),angular.module("vidadaApp").controller("LoginController",["$rootScope","$scope","$state","$timeout","Auth",function(e,t,a,r,n){t.user={},t.errors={},t.authenticationError=!1,t.rememberMe=!0,r(function(){angular.element('[ng-model="username"]').focus()}),t.login=function(){n.login({username:t.username,password:t.password,rememberMe:t.rememberMe}).then(function(){console.log("Login was successful!"),t.authenticationError=!1,"register"===e.previousStateName?a.go("home"):e.back()})["catch"](function(){console.log("Login failed!"),t.authenticationError=!0})}}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("login",{parent:"account",url:"/login",data:{roles:[],pageTitle:"login.title"},views:{"content@":{templateUrl:"scripts/app/account/login/login.html",controller:"LoginController"}},resolve:{translatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("login"),e.refresh()}]}})}]),angular.module("vidadaApp").controller("LogoutController",["Auth",function(e){e.logout()}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("logout",{parent:"account",url:"/logout",data:{roles:[]},views:{"content@":{templateUrl:"scripts/app/main/main.html",controller:"LogoutController"}}})}]),angular.module("vidadaApp").controller("PasswordController",["$scope","Auth","Principal",function(e,t,a){a.identity().then(function(t){e.account=t}),e.success=null,e.error=null,e.doNotMatch=null,e.changePassword=function(){e.password!==e.confirmPassword?e.doNotMatch="ERROR":(e.doNotMatch=null,t.changePassword(e.password).then(function(){e.error=null,e.success="OK"})["catch"](function(){e.success=null,e.error="ERROR"}))}}]),angular.module("vidadaApp").directive("passwordStrengthBar",function(){return{replace:!0,restrict:"E",template:'<div id="strength"><small translate="global.messages.validate.newpassword.strength">Password strength:</small><ul id="strengthBar"><li class="point"></li><li class="point"></li><li class="point"></li><li class="point"></li><li class="point"></li></ul></div>',link:function(e,t,a){var r={colors:["#F00","#F90","#FF0","#9F0","#0F0"],mesureStrength:function(e){var t=0,a=/[$-\/:-?{-~!"^_`\[\]]/g,r=/[a-z]+/.test(e),n=/[A-Z]+/.test(e),o=/[0-9]+/.test(e),i=a.test(e),l=[r,n,o,i],s=$.grep(l,function(e){return e===!0}).length;return t+=2*e.length+(e.length>=10?1:0),t+=10*s,t=e.length<=6?Math.min(t,10):t,t=1===s?Math.min(t,10):t,t=2===s?Math.min(t,20):t,t=3===s?Math.min(t,40):t},getColor:function(e){var t=0;return t=10>=e?0:20>=e?1:30>=e?2:40>=e?3:4,{idx:t+1,col:this.colors[t]}}};e.$watch(a.passwordToCheck,function(e){if(e){var a=r.getColor(r.mesureStrength(e));t.removeClass("ng-hide"),t.find("ul").children("li").css({background:"#DDD"}).slice(0,a.idx).css({background:a.col})}})}}}),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("password",{parent:"account",url:"/password",data:{roles:["ROLE_USER"],pageTitle:"global.menu.account.password"},views:{"content@":{templateUrl:"scripts/app/account/password/password.html",controller:"PasswordController"}},resolve:{translatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("password"),e.refresh()}]}})}]),angular.module("vidadaApp").controller("RegisterController",["$scope","$translate","$timeout","Auth",function(e,t,a,r){e.success=null,e.error=null,e.doNotMatch=null,e.errorUserExists=null,e.registerAccount={},a(function(){angular.element('[ng-model="registerAccount.login"]').focus()}),e.register=function(){e.registerAccount.password!==e.confirmPassword?e.doNotMatch="ERROR":(e.registerAccount.langKey=t.use(),e.doNotMatch=null,e.error=null,e.errorUserExists=null,e.errorEmailExists=null,r.createAccount(e.registerAccount).then(function(){e.success="OK"})["catch"](function(t){e.success=null,400===t.status&&"login already in use"===t.data?e.errorUserExists="ERROR":400===t.status&&"e-mail address already in use"===t.data?e.errorEmailExists="ERROR":e.error="ERROR"}))}}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("register",{parent:"account",url:"/register",data:{roles:[],pageTitle:"register.title"},views:{"content@":{templateUrl:"scripts/app/account/register/register.html",controller:"RegisterController"}},resolve:{translatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("register"),e.refresh()}]}})}]),angular.module("vidadaApp").controller("SettingsController",["$scope","Principal","Auth",function(e,t,a){e.success=null,e.error=null,t.identity().then(function(t){e.settingsAccount=t,e.debug=JSON.stringify(e.settingsAccount)}),e.save=function(){a.updateAccount(e.settingsAccount).then(function(){e.error=null,e.success="OK",t.identity().then(function(t){e.settingsAccount=t})})["catch"](function(){e.success=null,e.error="ERROR"})}}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("settings",{parent:"account",url:"/settings",data:{roles:["ROLE_USER"],pageTitle:"global.menu.account.settings"},views:{"content@":{templateUrl:"scripts/app/account/settings/settings.html",controller:"SettingsController"}},resolve:{translatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("settings"),e.refresh()}]}})}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("admin",{"abstract":!0,parent:"site"})}]),angular.module("vidadaApp").controller("ConfigurationController",["$scope","ConfigurationService",function(e,t){t.get().then(function(t){e.configuration=t})}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("configuration",{parent:"admin",url:"/configuration",data:{roles:["ROLE_ADMIN"],pageTitle:"configuration.title"},views:{"content@":{templateUrl:"scripts/app/admin/configuration/configuration.html",controller:"ConfigurationController"}},resolve:{translatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("configuration"),e.refresh()}]}})}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("docs",{parent:"admin",url:"/docs",data:{roles:["ROLE_ADMIN"],pageTitle:"global.menu.admin.apidocs"},views:{"content@":{templateUrl:"scripts/app/admin/docs/docs.html"}}})}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("entity",{"abstract":!0,parent:"site"})}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("error",{parent:"site",url:"/error",data:{roles:[],pageTitle:"errors.title"},views:{"content@":{templateUrl:"scripts/app/error/error.html"}},resolve:{mainTranslatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("error"),e.refresh()}]}}).state("accessdenied",{parent:"site",url:"/accessdenied",data:{roles:[]},views:{"content@":{templateUrl:"scripts/app/error/accessdenied.html"}},resolve:{mainTranslatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("error"),e.refresh()}]}})}]),angular.module("vidadaApp").controller("MainController",["$scope","Principal",function(e,t){t.identity().then(function(a){e.account=a,e.isAuthenticated=t.isAuthenticated})}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("home",{parent:"site",url:"/",data:{roles:[]},views:{"content@":{templateUrl:"scripts/app/main/main.html",controller:"MainController"}},resolve:{mainTranslatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("main"),e.refresh()}]}})}]),angular.module("vidadaApp").controller("LibrariesController",["$scope","$window","$mdToast","MediaLibrary","ErrorHandler","$mdDialog",function(e,t,a,r,n,o){function i(e,t){e.myLibrary={name:null,rootPath:null,ignoreMusic:!0,ignoreVideos:!1,ignoreImages:!1},e.ok=function(){t.hide(e.myLibrary)},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()}}i.$inject=["$scope","$mdDialog"],e.libraries=[],e.status="",e.updateLibraries=function(){r.query().$promise.then(function(t){e.libraries=t})},e.deleteLibrary=function(t,r){var n=o.confirm().title("Delete media library?").content("Are you sure you want to delete your media library "+r.name).targetEvent(t).ok("Delete it!").cancel("Lets keep it.");o.show(n).then(function(){r.$delete(function(){a.show(a.simple().content("Successfully deleted media-library!").hideDelay(2e3)),e.updateLibraries()},function(e){console.log(e),a.show(a.simple().content("Failed to delete media-library!").hideDelay(2e3))})})},e.newLibrary=function(t){o.show({controller:i,templateUrl:"AddNewLibrary.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0}).then(function(t){r.save(t,function(){e.updateLibraries(),a.show(a.simple().content("Created library: "+t.name).hideDelay(2e3))},function(e){n.showToast("Failed to create: "+t.name+" with rootPath "+t.rootPath,e)})})},e.updateLibraries()}]),angular.module("vidadaApp").controller("EditLibraryController",["$scope","$stateParams","MediaLibrary","$window","$mdToast","ErrorHandler",function(e,t,a,r,n,o){e.myLibraryId=t.libraryId,e.myLibrary={},a.get({libraryId:e.myLibraryId}).$promise.then(function(t){e.myLibrary=t},function(t){console.log("Failed to fetch library "+e.myLibraryId)}),e.saveLibrary=function(){var t=e.myLibrary;a.update(t,function(){n.show(n.simple().content("Updated library: "+t.name).hideDelay(2e3))},function(e){o.showToast("Failed to update: "+t.name+" with rootPath "+t.rootPath,e)})}}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("libraries",{parent:"vidada",url:"/libraries",data:{roles:["ROLE_ADMIN"],pageTitle:"libraries.title"},views:{"content@":{templateUrl:"scripts/app/vidada/libraries/libraries.html",controller:"LibrariesController"}},resolve:{translatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("libraries"),e.refresh()}]}}).state("detail-edit",{parent:"libraries",url:"/{libraryId}",views:{"detail@":{templateUrl:"scripts/app/vidada/libraries/libraries.edit.html",controller:"EditLibraryController"}}})}]),angular.module("vidadaApp").controller("MediasController",["$rootScope","$scope","$state","$stateParams","$anchorScroll","$timeout","$mdDialog","Media","MediaInfinite","ParseText","Tag",function(e,t,a,r,n,o,i,l,s,u,c){function d(e){for(var a=e.toLowerCase().trim(),r=[],n=0;n<t.knownTags.length&&r.length<10;n++){var o=t.knownTags[n].name;0===o.toLowerCase().indexOf(a)&&r.push({label:o,value:o})}return r}t.knownTags=[],t.selectedSuggestion=null,t.$state=a,t.currentMedia=null,t.tagExpressionCaret=0,t.availableOrderBy=[{id:"TITLE",name:"Title"},{id:"OPENED",name:"Times opened"},{id:"ADDEDDATE",name:"Date added"},{id:"LASTACCESS",name:"Access Date"},{id:"RATING",name:"Rating"},{id:"SIZE",name:"File size"},{id:"DURATION",name:"Duration"},{id:"BITRATE",name:"Bitrate"}],t.externalPlayers=[{app:"vlc",encode:!1},{app:"mpv",encode:!0}],t.externalPlayer=t.externalPlayers[1],t.mediaQuery={query:r.query,tagExpression:r.tagExpression,orderBy:t.availableOrderBy[2],reversed:"true"===r.reversed},t.scrollToCurrent=function(){null!=t.currentMedia&&(console.log("Scrolling to "+t.currentMedia.id),n(t.currentMedia.id))},t.play=function(e,a){t.currentMedia=a,i.show({controller:"MediaPlayerController",templateUrl:"/scripts/app/vidada/player/player_dialog.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,locals:{media:a}})},t.playExternal=function(e){if(t.currentMedia=e,"movie"==e.mediaType.toLowerCase()){var a=e.streamUrl;t.externalPlayer.encode&&(a=escape(e.streamUrl)),window.open(t.externalPlayer.app+"://"+a,"_self")}else window.open(e.streamUrl)},t.showDetail=function(e,a){t.currentMedia=a,i.show({controller:"MediasDetailController",templateUrl:"/scripts/app/vidada/medias/medias.detail_dialog.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,locals:{myMedia:a}})},t.updateMedias=function(){console.log("Query: "+JSON.stringify(t.mediaQuery)),t.mediaService=new s(t.mediaQuery),t.mediaService.nextPage()},t.setOrderBy=function(e){t.mediaQuery.orderBy=e,t.updateMedias()},t.$on("$viewContentLoaded",function(e){"medias"===a.current.name&&o(t.scrollToCurrent,10)});var g=function(e){var t=0;if(document.selection){e.focus();var a=document.selection.createRange();a.moveStart("character",-e.value.length),t=a.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t};t.updateCursorPos=function(e){var a=e.target;t.tagExpressionCaret=g(a)},t.updateTags=function(){c.query().$promise.then(function(e){t.knownTags=e,console.log("Got "+e.length+" known Tags!")})},t.suggest_tags=function(e){var a=u.findWordAt(e,t.tagExpressionCaret);console.log("Current tag: "+a);var r=d(a.text);return r.forEach(function(t){t.value=u.replaceWord(e,a,t.value)}),console.log("Found "+r.length+" suggestions for '"+a.text+"'!"),r},t.updateTags(),t.updateMedias()}]),angular.module("vidadaApp").controller("MediasDetailController",["$scope","$stateParams","$mdToast","Media","$mdDialog","myMedia",function(e,t,a,r,n,o){e.enableWatch=!1,e.media=null,e.thumbnailPositionEdit=0,e.tagsEdit=[],e.mediaDump={},e.thumbnailResource=null,e.loadMedia=function(){/\S/.test(e.mediaId)&&r.get({id:e.mediaId}).$promise.then(function(t){e.onMediaLoaded(t)},function(t){console.log("Failed to fetch media "+e.mediaId)})},e.onMediaLoaded=function(t){e.enableWatch=!1,e.media=t;var a=t.mediaType.toLowerCase();e.media.isVideo="movie"==a,e.media.isImage="image"==a,e.media.isSound="sound"==a,e.thumbnailPositionEdit=t.thumbnailPosition,e.tagsEdit=t.tags,e.thumbnailResource=t.thumbnailResource,e.mediaDump=JSON.stringify(t,null,2),e.enableWatch=!0},e["delete"]=function(){r["delete"]({mediaId:e.media.id},function(){a.show(a.simple().content("Successfully deleted media!").hideDelay(2e3)),e.cancel()},function(e){console.log("Failed to delete media! "+JSON.stringify(e)),a.show(a.simple().content("Failed to delete media! "+e.data.error).hideDelay(2e3))})},e.isFavorite=function(){return e.media&&e.media.rating>=5},e.toggleFavorite=function(){e.isFavorite()?e.media.rating=0:e.media.rating=5,r.update(e.media,function(){})},e.$watch("thumbnailPositionEdit",function(t){return e.enableWatch&&t?void setTimeout(function(){t===e.thumbnailPositionEdit&&(console.log("Updating thumb position to "+e.thumbnailPositionEdit),e.media.thumbnailPosition=e.thumbnailPositionEdit,e.thumbnailResource=null,r.update(e.media,function(){e.awaitNewThumbnail()},function(e){console.log("Failed to update thumb position! "+JSON.stringify(e))}))},200):0}),e.awaitNewThumbnail=function(t){return e.mediaId?(void 0===t&&(t=100),void r.get({id:e.mediaId}).$promise.then(function(a){a.thumbnailResource&&"Ready"==a.thumbnailResource.state?(e.media.thumbnailResource=a.thumbnailResource,e.thumbnailResource=a.thumbnailResource):(console.log("The thumbnail is not yet ready. "+JSON.stringify(a)),setTimeout(function(){e.awaitNewThumbnail(t+50)},t))},function(e){console.log("Failed to fetch media for thumb update! "+JSON.stringify(e))})):void console.log("Cant await thumbnails since id of this media is unknown!")},e.cancel=function(){n.cancel()},o?(e.mediaId=o.id,e.onMediaLoaded(o)):(e.mediaId=t.mediaId,e.loadMedia())}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("medias",{parent:"vidada",url:"/medias?query&tagExpression&sort&reversed",data:{roles:["ROLE_USER"],pageTitle:"medias.title"},views:{"content@":{templateUrl:"scripts/app/vidada/medias/medias.html",controller:"MediasController"}},params:{query:{value:"",squash:!0},tagExpression:{value:"",squash:!0},sort:{value:"ADDEDDATE"},reversed:{value:"false",squash:!0}},resolve:{translatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("medias"),e.refresh()}]}}).state("medias_detail",{parent:"medias",url:"/{mediaId}",data:{roles:["ROLE_USER"],pageTitle:"medias.title"},templateUrl:"scripts/app/vidada/medias/medias.detail.html",controller:"MediasDetailController"})}]),angular.module("vidadaApp").controller("MediaPlayerController",["$scope","$stateParams","Media","media",function(e,t,a,r){
var n=r.mediaType.toLowerCase();console.log("Playing media type "+n),r.isVideo="movie"==n,r.isImage="image"==n,r.isSound="sound"==n,e.media=r}]),angular.module("vidadaApp").controller("TagsController",["$scope","$window","Tag",function(e,t,a){e.tags=[],e.updateTags=function(){a.query().$promise.then(function(t){e.tags=t})},e.updateTags()}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("tags",{parent:"vidada",url:"/tags",data:{roles:["ROLE_ADMIN"],pageTitle:"tags.title"},views:{"content@":{templateUrl:"scripts/app/vidada/tags/tags.html",controller:"TagsController"}},resolve:{translatePartialLoader:["$translate","$translatePartialLoader",function(e,t){return t.addPart("tags"),e.refresh()}]}})}]),angular.module("vidadaApp").controller("VidadaController",["$rootScope","$scope","$location","$state","$mdSidenav","$mdMedia","Auth","Principal","$mdToast","MediaSynchronisation","ErrorHandler",function(e,t,a,r,n,o,i,l,s,u,c){t.$state=r,e.nextToContentOnDesktop=!0,e.desktopOpen=!0,t.mainMenuItems=[{name:"Media",state:"medias",icon:"ondemand_video"},{name:"Media Libraries",state:"libraries",icon:"video_library"},{name:"Tags",state:"tags",icon:"bookmark_border"},{name:"Settings",state:"settings",icon:"settings"}],l.identity().then(function(e){t.account=e}),t.isAuthenticated=function(){return l.isAuthenticated()},t.logout=function(){i.logout(),r.go("home")},t.isLockedOpen=function(){return e.nextToContentOnDesktop&&o("gt-md")&&e.desktopOpen},t.toggleLeftSideNav=function(){e.nextToContentOnDesktop&&o("gt-md")?e.desktopOpen=!e.desktopOpen:n("left").toggle()},t.syncAll=function(){u.sync().success(function(){s.show(s.simple().content("Synchronisation started ...").hideDelay(2e3))}).error(function(e,t){c.showToast("Failed to start synchronisation",e+" - "+t)})},t.openMenu=function(e,t){e(t)}}]),angular.module("vidadaApp").config(["$stateProvider",function(e){e.state("vidada",{"abstract":!0,parent:"site"})}]);